<?php
include_once "../../assets/php/var.php";
include_once "../../assets/php/functions.php";

// vérifier que l'on soit connecté pour accéder aux pages sinon retour vers index
//(!$is_connected)?header('Location: ../../index.html'):"";

//connection to DB
$my_Db_Connection= db_connect($servername,$db_to_use,$db_username,$db_password);

?>

<!DOCTYPE html>
<html lang="fr">

    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>List view</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.2/font/bootstrap-icons.css">
        <link rel="stylesheet" href="../../assets/css/style.css">
    </head>

    <body>
        <!-- insertion of standard header -->
        <?php include_once("../../assets/std_page/header.html") ?>

        <!-- insertion of standard navbar -->
        <?php include_once("../../assets/std_page/nav_bar.html") ?>

        <main>
            <div>
                <h1>Création d'une nouvelle liste</h1> 

                <form action="../../assets/php/actions/new_list_creation.php" method="POST">
                    <div class="">
                        <div id="list_name" class="form-group">
                            <label for="task_name">Nom de la liste</label>
                            <input class="form-control-sm mx-2" type="text" placeholder="Nom de la tâche" name="list_name" required>
                        </div>

                        <div id="list_description" class="form-group">
                            <label for="list_description">Description de la liste</label>
                            <textarea rows="2" cols="50" name="list_description" placeholder="Description de la liste" ></textarea>
                        </div>

                    </div>
                    <input type="submit" value="Créer une nouvelle liste">
                </form>

                <?php
                // insertion d'un message de résultat

                    if(isset($_GET['result_list'])){
                        if($_GET['result_list']==="success"){
                            echo "<p style='color:green'>La nouvelle liste a été créée </p>";
                        }
                        if($_GET['result_list']==="error"){
                            echo "<p style='color:red'>Une erreur est survenue lors de la création de la liste</p>";
                        }
                        if($_GET['result_list']==="name"){
                            echo "<p style='color:red'>Ce nom est déja pris la liste n'a pas été créée</p>";
                        }
                    }
                ?>
            </div>
            <br>

            <div>
                <h1>Création d'une nouvelle tâche</h1>
            

                <form action="../../assets/php/actions/new_task_creation.php" method="POST">
                    <div class="">
                        <div id="task_name" class="form-group">
                            <label for="task_name">Nom de la tâche</label>
                            <input class="form-control-sm mx-2" type="text" placeholder="Nom de la tâche" name="task_name" required>
                        </div>

                        <div>
                            <label for="list_name">Liste associée à la tâche:</label>

                            <select name="list_name" id="list_name" required>
                                <option value="">--Choisir la liste--</option>
                                <?php
                                // impression pour chaque liste existante
                                $array_list= list_retrieve($my_Db_Connection);

                                    for ($i=0;$i < count($array_list);$i++){
                                    echo '<option value="'.$array_list[$i].'">'.$array_list[$i].'</option>';
                                    }
                                ?>
                            </select>
                        </div>

                        <div id="task_description" class="form-group">
                            <label for="task_description">Description de la tâche</label>
                            <textarea rows="4" cols="50" name="task_description" placeholder="Description de la tâche" required></textarea>
                        </div>

                        <div>
                            <label for="task_responsible">Qui est le responsable?</label>

                            <select name="task_responsible" id="task_responsible" required>
                                <option value="">--Choisir le responsable de la tâche--</option>
                                <option value="<?php ucfirst($username) ?>">Moi (<?php ucfirst($username) ?>) </option>
                                <?php
                                    // on mets les noms des membres de l'équipe dans le menu
                                    for($i = 0; $i < count($array_team); ++$i) {
                                        echo ' <option value="'.$array_team[$i].'">'.$array_team[$i].'</option>';
                                    }
                                ?>
                                <option value="autre">Autre (voir commentaires)</option>
                            </select>
                        </div>

                        <div>
                            <label for="task_status">Etat de la tâche?</label>

                            <select name="task_status" id="task_status" required>
                                <option value="">--Choisir l'état de la tâche--</option>
                                <option value="Non commencée">Non commencée</option>
                                <option value="En cours">En cours</option>
                                <option value="Terminée">Terminée</option>
                                <option value="En suspend">En suspend</option>
                            </select>
                        </div>

                        <div id="task_end_date" class="form-group">
                            <label for="task_end_date">Date de fin requise: </label>
                            <input class="form-control-sm mx-2" type="date" placeholder="Selectionnez la date de fin" name="task_end_date" required>
                        </div>
                        <div>
                            <input type="checkbox" id="task_important" name="task_important" value="1">
                            <label for="important">A cocher si la tâche est importante</label>
                        </div>
                        <div id="task_comment" class="form-group">
                            <label for="task_comment">Commentaires</label>
                            <textarea rows="1" cols="50" name="task_comment" placeholder="Commentaires"></textarea>
                        </div>
                    </div>
                    <input type="submit" value="Créer une nouvelle tâche">
                </form>

                <?php
                // insertion d'un message de résultat

                    if(isset($_GET['result_task'])){
                        if($_GET['result_task']==="success"){
                            echo "<p style='color:green'>La nouvelle tâche a été créée </p>";
                        }
                        if($_GET['result_task']==="error"){
                            echo "<p style='color:red'>Une erreur est survenue lors de la création de la tâche</p>";
                        }
                        if($_GET['result_task']==="error1"){
                            echo "<p style='color:rgb(255, 136, 0)'>Utilisez un autre nom de tâche</p>";
                        }
                    }
                ?>
            </div>
        </main>



        <!-- insertion of standard footer -->
        <?php include_once("../../assets/std_page/footer.html") ?>

    </body>
</html>